<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Portfolio Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #002855;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            position: relative;
        }

        .loading {
            text-align: center;
            color: #fff;
            font-size: 20px;
            padding: 50px;
        }

        .book-container {
            display: none;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            cursor: grab;
        }

        .book-container.grabbing {
            cursor: grabbing;
        }

        .book-wrapper {
            position: relative;
            transform-origin: center center;
            transition: transform 0.1s ease-out;
        }

        .book {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 707px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .book.double-page {
            max-width: 1020px;
        }

        .page {
            width: 500px;
            height: 707px;
            background: #fff;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            position: relative;
            flex-shrink: 0;
        }

        .page img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: block;
            pointer-events: none;
            user-select: none;
        }

        .controls {
            display: none;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        button {
            background: transparent;
            border: none;
            padding: 15px;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.3s;
            color: #fff;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
        }

        button:hover {
            transform: scale(1.2);
            opacity: 0.8;
        }

        button:disabled {
            opacity: 0.2;
            cursor: not-allowed;
        }
        
        button:disabled:hover {
            transform: scale(1);
        }

        .page-counter {
            display: none;
            color: #fff;
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
        }

        .zoom-info {
            display: none;
            color: #fff;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.7;
        }

        @media (max-width: 1100px) {
            .book {
                max-width: 400px;
                height: 566px;
            }

            .book.double-page {
                max-width: 820px;
            }

            .page {
                width: 400px;
                height: 566px;
            }
        }

        @media (max-width: 900px) {
            .book {
                max-width: 350px;
                height: 495px;
            }

            .book.double-page {
                max-width: 720px;
            }

            .page {
                width: 350px;
                height: 495px;
            }
        }

        @media (max-width: 768px) {
            .book {
                max-width: 300px;
                height: 424px;
            }

            .book.double-page {
                max-width: 620px;
            }

            .page {
                width: 300px;
                height: 424px;
            }
            
            button {
                font-size: 35px;
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 650px) {
            .book {
                max-width: 200px;
                height: 283px;
            }

            .book.double-page {
                max-width: 410px;
            }

            .page {
                width: 200px;
                height: 283px;
            }
            
            .controls {
                gap: 30px;
            }
            
            button {
                font-size: 30px;
                width: 45px;
                height: 45px;
            }
        }

        @media (max-width: 450px) {
            .book {
                max-width: 150px;
                height: 212px;
            }

            .book.double-page {
                max-width: 310px;
            }

            .page {
                width: 150px;
                height: 212px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loading" id="loading">
            Chargement du portfolio...
        </div>

        <div class="book-container" id="book-container">
            <div class="book-wrapper" id="book-wrapper">
                <div class="book" id="book">
                    <!-- Les pages seront générées ici -->
                </div>
            </div>
        </div>

        <div class="controls" id="controls">
            <button id="prev-btn" onclick="prevSpread()">←</button>
            <button id="next-btn" onclick="nextSpread()">→</button>
        </div>

        <div class="page-counter" id="page-counter">
            <span id="page-info"></span>
        </div>
        
        <div class="zoom-info" id="zoom-info">
            Molette/Pinch pour zoomer • Double-clic gauche/droite pour naviguer
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let currentSpread = 0;
        let pages = [];
        let pdfDoc = null;

        // Variables pour le zoom et le déplacement
        let scale = 1;
        let minScale = 1;
        let maxScale = 5;
        let isPanning = false;
        let startX = 0;
        let startY = 0;
        let translateX = 0;
        let translateY = 0;

        const bookContainer = document.getElementById('book-container');
        const bookWrapper = document.getElementById('book-wrapper');
        const bookElement = document.getElementById('book');

        // Charger automatiquement le PDF
        window.addEventListener('load', function() {
            loadPDFFromURL('portfolio.pdf');
        });

        async function loadPDFFromURL(url) {
            try {
                const loadingTask = pdfjsLib.getDocument(url);
                pdfDoc = await loadingTask.promise;
                const numPages = pdfDoc.numPages;
                
                pages = [];

                for (let i = 1; i <= numPages; i++) {
                    const page = await pdfDoc.getPage(i);
                    const viewport = page.getViewport({ scale: 2 });
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;

                    pages.push(canvas.toDataURL());
                }

                currentSpread = 0;
                renderSpread();
                updatePageCounter();
                updateButtons();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('book-container').style.display = 'flex';
                document.getElementById('controls').style.display = 'flex';
                document.getElementById('page-counter').style.display = 'block';
                document.getElementById('zoom-info').style.display = 'block';
            } catch (error) {
                document.getElementById('loading').innerHTML = 'Erreur : Impossible de charger le fichier portfolio.pdf<br><br>Vérifiez que le fichier existe dans le même dossier que index.html';
                console.error('Erreur de chargement du PDF:', error);
            }
        }

        function renderSpread() {
            bookElement.innerHTML = '';
            resetZoom();

            if (pages.length === 0) return;

            // Première page (couverture) seule
            if (currentSpread === 0) {
                bookElement.className = 'book';
                const page = createPage(pages[0], 0);
                bookElement.appendChild(page);
            } 
            // Pages suivantes en vis-à-vis
            else {
                bookElement.className = 'book double-page';
                
                const leftIndex = (currentSpread - 1) * 2 + 1;
                const rightIndex = leftIndex + 1;

                if (leftIndex < pages.length) {
                    const leftPage = createPage(pages[leftIndex], leftIndex);
                    bookElement.appendChild(leftPage);
                }

                if (rightIndex < pages.length) {
                    const rightPage = createPage(pages[rightIndex], rightIndex);
                    bookElement.appendChild(rightPage);
                }
            }
        }

        function createPage(imageSrc, index) {
            const pageDiv = document.createElement('div');
            pageDiv.className = 'page';
            
            const img = document.createElement('img');
            img.src = imageSrc;
            pageDiv.appendChild(img);

            return pageDiv;
        }

        // Zoom avec la molette de la souris
        bookContainer.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            const rect = bookContainer.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            const newScale = Math.min(Math.max(minScale, scale * delta), maxScale);
            
            if (newScale !== scale) {
                const scaleRatio = newScale / scale;
                translateX = mouseX - (mouseX - translateX) * scaleRatio;
                translateY = mouseY - (mouseY - translateY) * scaleRatio;
                scale = newScale;
                updateTransform();
            }
        }, { passive: false });

        // Zoom tactile (pinch)
        let initialDistance = 0;
        let initialScale = 1;

        bookContainer.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                initialDistance = getDistance(e.touches[0], e.touches[1]);
                initialScale = scale;
            } else if (e.touches.length === 1 && scale > 1) {
                isPanning = true;
                startX = e.touches[0].clientX - translateX;
                startY = e.touches[0].clientY - translateY;
                bookContainer.classList.add('grabbing');
            }
        }, { passive: false });

        bookContainer.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                const currentDistance = getDistance(e.touches[0], e.touches[1]);
                const newScale = Math.min(Math.max(minScale, initialScale * (currentDistance / initialDistance)), maxScale);
                scale = newScale;
                updateTransform();
            } else if (e.touches.length === 1 && isPanning) {
                e.preventDefault();
                translateX = e.touches[0].clientX - startX;
                translateY = e.touches[0].clientY - startY;
                updateTransform();
            }
        }, { passive: false });

        bookContainer.addEventListener('touchend', (e) => {
            if (e.touches.length < 2) {
                isPanning = false;
                bookContainer.classList.remove('grabbing');
            }
        });

        function getDistance(touch1, touch2) {
            const dx = touch1.clientX - touch2.clientX;
            const dy = touch1.clientY - touch2.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // Déplacement avec la souris en mode zoom
        bookContainer.addEventListener('mousedown', (e) => {
            if (scale > 1) {
                e.preventDefault();
                isPanning = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                bookContainer.classList.add('grabbing');
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (isPanning) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateTransform();
            }
        });

        document.addEventListener('mouseup', () => {
            isPanning = false;
            bookContainer.classList.remove('grabbing');
        });

        function updateTransform() {
            bookWrapper.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        }

        function resetZoom() {
            scale = 1;
            translateX = 0;
            translateY = 0;
            updateTransform();
        }

        // Double-clic pour navigation gauche/droite
        let lastClickTime = 0;
        let lastClickX = 0;

        bookContainer.addEventListener('click', (e) => {
            const currentTime = new Date().getTime();
            const timeDiff = currentTime - lastClickTime;
            
            if (timeDiff < 300 && timeDiff > 0) {
                // C'est un double-clic
                e.preventDefault();
                const rect = bookContainer.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const containerWidth = rect.width;
                
                if (clickX < containerWidth / 2) {
                    prevSpread();
                } else {
                    nextSpread();
                }
            }
            
            lastClickTime = currentTime;
            lastClickX = e.clientX;
        });

        function nextSpread() {
            const maxSpread = Math.ceil(pages.length / 2);
            
            if (currentSpread < maxSpread - 1) {
                currentSpread++;
                renderSpread();
                updatePageCounter();
                updateButtons();
            }
        }

        function prevSpread() {
            if (currentSpread > 0) {
                currentSpread--;
                renderSpread();
                updatePageCounter();
                updateButtons();
            }
        }

        function updatePageCounter() {
            let pageText = '';
            if (currentSpread === 0) {
                pageText = `Page 1 / ${pages.length}`;
            } else {
                const leftPage = (currentSpread - 1) * 2 + 2;
                const rightPage = Math.min(leftPage + 1, pages.length);
                if (leftPage === rightPage) {
                    pageText = `Page ${leftPage} / ${pages.length}`;
                } else {
                    pageText = `Pages ${leftPage}-${rightPage} / ${pages.length}`;
                }
            }
            document.getElementById('page-info').textContent = pageText;
        }

        function updateButtons() {
            const maxSpread = Math.ceil(pages.length / 2);
            document.getElementById('prev-btn').disabled = currentSpread === 0;
            document.getElementById('next-btn').disabled = currentSpread >= maxSpread - 1;
        }

        // Support clavier
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') {
                prevSpread();
            } else if (e.key === 'ArrowRight') {
                nextSpread();
            } else if (e.key === 'Escape') {
                resetZoom();
            }
        });

        // Support swipe mobile (horizontal uniquement si pas de zoom)
        let touchStartX = 0;

        bookContainer.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1 && scale === 1) {
                touchStartX = e.touches[0].clientX;
            }
        });

        bookContainer.addEventListener('touchend', (e) => {
            if (scale === 1 && e.changedTouches.length === 1) {
                const touchEndX = e.changedTouches[0].clientX;
                const diff = touchStartX - touchEndX;
                
                if (Math.abs(diff) > 50) {
                    if (diff > 0) {
                        nextSpread();
                    } else {
                        prevSpread();
                    }
                }
            }
        });
    </script>
</body>
</html>
