<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #002855;
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            position: relative;
        }

        .loading {
            text-align: center;
            color: #fff;
            font-size: 20px;
            padding: 50px;
        }

        .book-container {
            display: none;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
        }

        .book {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: 707px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .book.double-page {
            max-width: 1020px;
        }

        .page {
            width: 500px;
            height: 707px;
            background: #fff;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            cursor: pointer;
            position: relative;
        }

        .page img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: block;
        }

        .page.zoomed {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(2);
            z-index: 1000;
            cursor: move;
            width: 500px;
            height: 707px;
        }

        .zoom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 40, 85, 0.95);
            z-index: 999;
            display: none;
        }

        .zoom-overlay.active {
            display: block;
        }

        .controls {
            display: none;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        button {
            background: transparent;
            border: none;
            padding: 15px;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.3s;
            color: #fff;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
        }

        button:hover {
            transform: scale(1.2);
            opacity: 0.8;
        }

        button:disabled {
            opacity: 0.2;
            cursor: not-allowed;
        }
        
        button:disabled:hover {
            transform: scale(1);
        }

        .page-counter {
            display: none;
            color: #fff;
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
        }

        .zoom-info {
            display: none;
            color: #fff;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.7;
        }

        @media (max-width: 1100px) {
            .book {
                max-width: 400px;
                height: 566px;
            }

            .book.double-page {
                max-width: 820px;
            }

            .page {
                width: 400px;
                height: 566px;
            }

            .page.zoomed {
                width: 400px;
                height: 566px;
            }
        }

        @media (max-width: 900px) {
            .book {
                max-width: 350px;
                height: 495px;
            }

            .book.double-page {
                max-width: 720px;
            }

            .page {
                width: 350px;
                height: 495px;
            }

            .page.zoomed {
                width: 350px;
                height: 495px;
            }
        }

        @media (max-width: 768px) {
            .book {
                max-width: 300px;
                height: 424px;
            }

            .book.double-page {
                max-width: 620px;
            }

            .page {
                width: 300px;
                height: 424px;
            }

            .page.zoomed {
                width: 300px;
                height: 424px;
            }
            
            button {
                font-size: 35px;
                width: 50px;
                height: 50px;
            }
        }

        @media (max-width: 650px) {
            .book {
                max-width: 250px;
                height: 354px;
            }

            .book.double-page {
                max-width: 250px;
                flex-direction: column;
                height: auto;
                gap: 20px;
            }

            .page {
                width: 250px;
                height: 354px;
            }

            .page.zoomed {
                width: 250px;
                height: 354px;
            }
            
            .controls {
                gap: 30px;
            }
            
            button {
                font-size: 30px;
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body>
    <div class="zoom-overlay" id="zoom-overlay"></div>

    <div class="container">
        <div class="loading" id="loading">
            Chargement du portfolio...
        </div>

        <div class="book-container" id="book-container">
            <div class="book" id="book">
                <!-- Les pages seront générées ici -->
            </div>
        </div>

        <div class="controls" id="controls">
            <button id="prev-btn" onclick="prevSpread()">←</button>
            <button id="next-btn" onclick="nextSpread()">→</button>
        </div>

        <div class="page-counter" id="page-counter">
            <span id="page-info"></span>
        </div>
        
        <div class="zoom-info" id="zoom-info">
            Double-cliquez sur une page pour zoomer • Cliquez pour changer de page
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let currentSpread = 0;
        let pages = [];
        let pdfDoc = null;
        let zoomedElement = null;

        const bookElement = document.getElementById('book');
        const overlay = document.getElementById('zoom-overlay');

        // Charger automatiquement le PDF au chargement de la page
        window.addEventListener('load', function() {
            loadPDFFromURL('portfolio.pdf');
        });

        async function loadPDFFromURL(url) {
            try {
                const loadingTask = pdfjsLib.getDocument(url);
                pdfDoc = await loadingTask.promise;
                const numPages = pdfDoc.numPages;
                
                pages = [];

                for (let i = 1; i <= numPages; i++) {
                    const page = await pdfDoc.getPage(i);
                    const viewport = page.getViewport({ scale: 2 });
                    
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;

                    pages.push(canvas.toDataURL());
                }

                currentSpread = 0;
                renderSpread();
                updatePageCounter();
                updateButtons();
                
                // Afficher le portfolio et masquer le chargement
                document.getElementById('loading').style.display = 'none';
                document.getElementById('book-container').style.display = 'flex';
                document.getElementById('controls').style.display = 'flex';
                document.getElementById('page-counter').style.display = 'block';
                document.getElementById('zoom-info').style.display = 'block';
            } catch (error) {
                document.getElementById('loading').innerHTML = 'Erreur : Impossible de charger le fichier portfolio.pdf<br><br>Vérifiez que le fichier existe dans le même dossier que index.html';
                console.error('Erreur de chargement du PDF:', error);
            }
        }

        function renderSpread() {
            bookElement.innerHTML = '';

            if (pages.length === 0) return;

            // Première page (couverture) seule
            if (currentSpread === 0) {
                bookElement.className = 'book';
                const page = createPage(pages[0], 0);
                bookElement.appendChild(page);
            } 
            // Pages suivantes en vis-à-vis (double page)
            else {
                bookElement.className = 'book double-page';
                
                const leftIndex = (currentSpread - 1) * 2 + 1;
                const rightIndex = leftIndex + 1;

                if (leftIndex < pages.length) {
                    const leftPage = createPage(pages[leftIndex], leftIndex);
                    bookElement.appendChild(leftPage);
                }

                if (rightIndex < pages.length) {
                    const rightPage = createPage(pages[rightIndex], rightIndex);
                    bookElement.appendChild(rightPage);
                }
            }
        }

        function createPage(imageSrc, index) {
            const pageDiv = document.createElement('div');
            pageDiv.className = 'page';
            
            const img = document.createElement('img');
            img.src = imageSrc;
            pageDiv.appendChild(img);

            // Double-clic pour zoom
            pageDiv.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                toggleZoom(pageDiv);
            });

            // Clic simple pour navigation
            pageDiv.addEventListener('click', (e) => {
                if (zoomedElement) return;
                e.stopPropagation();
                
                const rect = pageDiv.getBoundingClientRect();
                const x = e.clientX - rect.left;
                
                if (x < rect.width / 2) {
                    prevSpread();
                } else {
                    nextSpread();
                }
            });

            return pageDiv;
        }

        function toggleZoom(element) {
            if (zoomedElement === element) {
                element.classList.remove('zoomed');
                overlay.classList.remove('active');
                zoomedElement = null;
            } else {
                if (zoomedElement) {
                    zoomedElement.classList.remove('zoomed');
                }
                element.classList.add('zoomed');
                overlay.classList.add('active');
                zoomedElement = element;
            }
        }

        // Fermer le zoom en cliquant sur l'overlay
        overlay.addEventListener('click', () => {
            if (zoomedElement) {
                zoomedElement.classList.remove('zoomed');
                overlay.classList.remove('active');
                zoomedElement = null;
            }
        });

        function nextSpread() {
            const maxSpread = Math.ceil(pages.length / 2);
            
            if (currentSpread < maxSpread - 1) {
                currentSpread++;
                renderSpread();
                updatePageCounter();
                updateButtons();
            }
        }

        function prevSpread() {
            if (currentSpread > 0) {
                currentSpread--;
                renderSpread();
                updatePageCounter();
                updateButtons();
            }
        }

        function updatePageCounter() {
            let pageText = '';
            if (currentSpread === 0) {
                pageText = `Page 1 / ${pages.length}`;
            } else {
                const leftPage = (currentSpread - 1) * 2 + 2;
                const rightPage = Math.min(leftPage + 1, pages.length);
                if (leftPage === rightPage) {
                    pageText = `Page ${leftPage} / ${pages.length}`;
                } else {
                    pageText = `Pages ${leftPage}-${rightPage} / ${pages.length}`;
                }
            }
            document.getElementById('page-info').textContent = pageText;
        }

        function updateButtons() {
            const maxSpread = Math.ceil(pages.length / 2);
            document.getElementById('prev-btn').disabled = currentSpread === 0;
            document.getElementById('next-btn').disabled = currentSpread >= maxSpread - 1;
        }

        // Support clavier
        document.addEventListener('keydown', (e) => {
            if (zoomedElement && e.key === 'Escape') {
                toggleZoom(zoomedElement);
                return;
            }
            
            if (e.key === 'ArrowLeft') {
                prevSpread();
            } else if (e.key === 'ArrowRight') {
                nextSpread();
            }
        });

        // Support swipe mobile
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            if (zoomedElement) return;
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            if (zoomedElement) return;
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            const swipeThreshold = 50;
            if (touchEndX < touchStartX - swipeThreshold) {
                nextSpread();
            }
            if (touchEndX > touchStartX + swipeThreshold) {
                prevSpread();
            }
        }
    </script>
</body>
</html>
